{% extends "admin/index.html" %}
{% load static %}

{% block content %}
<div class="kpi-dashboard">
    <h1 style="margin-bottom: 30px;">üìä Dashboard SaaS - FOX-REVIEWS</h1>
    
    <!-- KPIs Globaux -->
    <div class="kpi-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;">
        
        <!-- Entreprises -->
        <div class="kpi-card" style="background: #e3f2fd; padding: 20px; border-radius: 8px; border-left: 4px solid #2196F3;">
            <h3 style="margin: 0 0 10px 0; color: #1976D2;">üè¢ Entreprises</h3>
            <div style="font-size: 36px; font-weight: bold; color: #2196F3;">{{ total_entreprises }}</div>
            <div style="color: #666; margin-top: 5px;">Total actives</div>
        </div>
        
        <!-- Abonnements actifs -->
        <div class="kpi-card" style="background: #e8f5e9; padding: 20px; border-radius: 8px; border-left: 4px solid #4CAF50;">
            <h3 style="margin: 0 0 10px 0; color: #388E3C;">üí≥ Abonnements Actifs</h3>
            <div style="font-size: 36px; font-weight: bold; color: #4CAF50;">{{ active_subscriptions }}</div>
            <div style="color: #666; margin-top: 5px;">Sur {{ total_subscriptions }} total</div>
        </div>
        
        <!-- MRR -->
        <div class="kpi-card" style="background: #fff3e0; padding: 20px; border-radius: 8px; border-left: 4px solid #FF9800;">
            <h3 style="margin: 0 0 10px 0; color: #F57C00;">üí∞ MRR</h3>
            <div style="font-size: 36px; font-weight: bold; color: #FF9800;">{{ mrr|floatformat:0 }}‚Ç¨</div>
            <div style="color: #666; margin-top: 5px;">Revenu mensuel r√©current</div>
        </div>
        
        <!-- Sponsorisations actives -->
        <div class="kpi-card" style="background: #f3e5f5; padding: 20px; border-radius: 8px; border-left: 4px solid #9C27B0;">
            <h3 style="margin: 0 0 10px 0; color: #7B1FA2;">‚≠ê Sponsorisations</h3>
            <div style="font-size: 36px; font-weight: bold; color: #9C27B0;">{{ active_sponsorisations }}</div>
            <div style="color: #666; margin-top: 5px;">Actives maintenant</div>
        </div>
        
        <!-- Factures du mois -->
        <div class="kpi-card" style="background: #e0f2f1; padding: 20px; border-radius: 8px; border-left: 4px solid #009688;">
            <h3 style="margin: 0 0 10px 0; color: #00796B;">üìÑ Factures (mois)</h3>
            <div style="font-size: 36px; font-weight: bold; color: #009688;">{{ paid_invoices_this_month }}</div>
            <div style="color: #666; margin-top: 5px;">Pay√©es / {{ invoices_this_month }} total</div>
        </div>
        
        <!-- Revenu du mois -->
        <div class="kpi-card" style="background: #fce4ec; padding: 20px; border-radius: 8px; border-left: 4px solid #E91E63;">
            <h3 style="margin: 0 0 10px 0; color: #C2185B;">üíµ Revenu (mois)</h3>
            <div style="font-size: 36px; font-weight: bold; color: #E91E63;">{{ revenue_this_month|floatformat:0 }}‚Ç¨</div>
            <div style="color: #666; margin-top: 5px;">Ce mois-ci</div>
        </div>
        
        <!-- Clics (30j) -->
        <div class="kpi-card" style="background: #e1f5fe; padding: 20px; border-radius: 8px; border-left: 4px solid #03A9F4;">
            <h3 style="margin: 0 0 10px 0; color: #0288D1;">üñ±Ô∏è Clics (30j)</h3>
            <div style="font-size: 36px; font-weight: bold; color: #03A9F4;">{{ clicks_30d }}</div>
            <div style="color: #666; margin-top: 5px;">30 derniers jours</div>
        </div>
        
        <!-- Vues (30j) -->
        <div class="kpi-card" style="background: #f1f8e9; padding: 20px; border-radius: 8px; border-left: 4px solid #8BC34A;">
            <h3 style="margin: 0 0 10px 0; color: #689F38;">üëÅÔ∏è Vues (30j)</h3>
            <div style="font-size: 36px; font-weight: bold; color: #8BC34A;">{{ views_30d }}</div>
            <div style="color: #666; margin-top: 5px;">30 derniers jours</div>
        </div>
        
        <!-- CTR (30j) -->
        <div class="kpi-card" style="background: #fff9c4; padding: 20px; border-radius: 8px; border-left: 4px solid #FFC107;">
            <h3 style="margin: 0 0 10px 0; color: #F57F17;">üìà CTR (30j)</h3>
            <div style="font-size: 36px; font-weight: bold; color: #FFC107;">{{ ctr_30d }}%</div>
            <div style="color: #666; margin-top: 5px;">Click-through rate</div>
        </div>
    </div>
    
    <!-- D√©tails -->
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 20px;">
        
        <!-- Clics par source -->
        <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
            <h3 style="margin-top: 0; color: #333;">üîç Clics par source (30j)</h3>
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="background: #f5f5f5;">
                        <th style="padding: 10px; text-align: left;">Source</th>
                        <th style="padding: 10px; text-align: right;">Clics</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in clicks_by_source %}
                    <tr style="border-bottom: 1px solid #eee;">
                        <td style="padding: 10px;">{{ item.source }}</td>
                        <td style="padding: 10px; text-align: right; font-weight: bold;">{{ item.count }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="2" style="padding: 10px; text-align: center; color: #999;">Aucune donn√©e</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        <!-- Top 10 entreprises les plus cliqu√©es -->
        <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
            <h3 style="margin-top: 0; color: #333;">üèÜ Top 10 entreprises - Clics (30j)</h3>
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="background: #f5f5f5;">
                        <th style="padding: 10px; text-align: left;">Entreprise</th>
                        <th style="padding: 10px; text-align: right;">Clics</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in top_entreprises_clicks %}
                    <tr style="border-bottom: 1px solid #eee;">
                        <td style="padding: 10px;">
                            <a href="{% url 'admin:enterprise_entreprise_change' item.entreprise__id %}">
                                {{ item.entreprise__nom|truncatechars:40 }}
                            </a>
                        </td>
                        <td style="padding: 10px; text-align: right; font-weight: bold; color: #2196F3;">{{ item.count }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="2" style="padding: 10px; text-align: center; color: #999;">Aucune donn√©e</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        <!-- Top 10 entreprises les plus vues -->
        <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
            <h3 style="margin-top: 0; color: #333;">üèÜ Top 10 entreprises - Vues (30j)</h3>
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="background: #f5f5f5;">
                        <th style="padding: 10px; text-align: left;">Entreprise</th>
                        <th style="padding: 10px; text-align: right;">Vues</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in top_entreprises_views %}
                    <tr style="border-bottom: 1px solid #eee;">
                        <td style="padding: 10px;">
                            <a href="{% url 'admin:enterprise_entreprise_change' item.entreprise__id %}">
                                {{ item.entreprise__nom|truncatechars:40 }}
                            </a>
                        </td>
                        <td style="padding: 10px; text-align: right; font-weight: bold; color: #4CAF50;">{{ item.count }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="2" style="padding: 10px; text-align: center; color: #999;">Aucune donn√©e</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    
    <div style="margin-top: 30px; padding: 20px; background: #f5f5f5; border-radius: 8px;">
        <p style="margin: 0; color: #666; text-align: center;">
            <strong>Dashboard SaaS FOX-REVIEWS</strong> - Donn√©es en temps r√©el
        </p>
    </div>
</div>
{% endblock %}
